--QUERIES 

--a
SELECT * FROM AUTHORS;

--b
SELECT AUTHOR_LNAME , AUTHOR_FNAME , COUNTRY FROM AUTHORS ORDER BY AUTHOR_LNAME DESC;

--c
SELECT A.AUTHOR_ID, A.AUTHOR_LNAME , A.AUTHOR_FNAME , B.GENRE FROM AUTHORS A JOIN BOOKS B ON B.AUTHOR_ID = A.AUTHOR_ID WHERE B.GENRE = 'HORROR' OR B.GENRE = 'POETRY';

SELECT AUTHOR_ID , AUTHOR_LNAME , AUTHOR_FNAME FROM AUTHORS WHERE AUTHOR_LNAME LIKE  'A%EN' AND AUTHOR_FNAME LIKE 'J%E' ;

SELECT AUTHOR_LNAME , AUTHOR_FNAME FROM AUTHORS WHERE COUNTRY != 'GREECE' AND COUNTRY != 'USA' ;

SELECT LOAN_ID FROM LOANS WHERE (DOL BETWEEN '01-APR-2020' AND '01-SEP-2021') AND (DOR BETWEEN '01-APR-2020' AND '01-SEP-2021') ;

--d 
SELECT COPY_ID , TITLE , GENRE FROM BOOKS JOIN COPY ON BOOKS.ISBN = COPY.ISBN;

SELECT COPY_ID , TITLE , AUTHOR_LNAME FROM BOOKS JOIN COPY ON BOOKS.ISBN = COPY.ISBN JOIN AUTHORS ON AUTHORS.AUTHOR_ID = BOOKS.AUTHOR_ID; 

SELECT C.COPY_ID , L.LOAN_ID , U.USER_ID , B.TITLE , A.AUTHOR_LNAME FROM USERS U JOIN LOANS L ON U.USER_ID  = L.USER_ID JOIN COPY C ON C.COPY_ID = L.COPY_ID JOIN BOOKS B ON B.ISBN = C.ISBN JOIN AUTHORS A ON A.AUTHOR_ID = B.AUTHOR_ID;

--e 
--1
SELECT AUTHOR_LNAME,AUTHOR_FNAME FROM AUTHORS WHERE AUTHOR_LNAME LIKE 'K%' AND AUTHOR_LNAME LIKE '%G';

--2
SELECT GENRE,COUNT(ISBN) FROM BOOKS GROUP BY GENRE;

--3 
SELECT COUNT(L.ISBN), B.TITLE FROM BOOKS B JOIN COPY C ON B.ISBN = C.ISBN JOIN LOANS L ON L.COPY_ID = C.COPY_ID GROUP BY B.TITLE ORDER BY COUNT(C.ISBN) DESC FETCH FIRST 1 ROWS ONLY;

--4
SELECT AUTHOR_LNAME,TITLE FROM AUTHORS,BOOKS WHERE AUTHORS.AUTHOR_ID=BOOKS.AUTHOR_ID ORDER BY AUTHOR_LNAME ASC; 

--5
SELECT EXTRACT(YEAR FROM DOP),COUNT(ISBN) FROM BOOKS WHERE EXTRACT(YEAR FROM DOP) LIKE '%1981%' GROUP BY EXTRACT(YEAR FROM DOP);

--6
SELECT AUTHOR_LNAME,GENRE FROM AUTHORS JOIN BOOKS ON AUTHORS.AUTHOR_ID=BOOKS.AUTHOR_ID WHERE GENRE='HORROR' OR GENRE='SCI-FI' ;

--7
SELECT TITLE , DOL FROM BOOKS JOIN COPY ON BOOKS.ISBN = COPY.ISBN JOIN LOANS  ON LOANS.COPY_ID = COPY.COPY_ID WHERE TO_CHAR(DOL,'MON') = 'OCT';

--8 
SELECT (SELECT COUNT(AUTHOR_LNAME) FROM AUTHORS WHERE DOD IS NOT NULL) DECEASED , (SELECT COUNT(AUTHOR_LNAME) FROM AUTHORS WHERE DOD IS NULL) ALIVE FROM AUTHORS FETCH FIRST 1 ROWS ONLY ;

--9
SELECT AUTHOR_LNAME,DOB,DOD,EXTRACT(YEAR FROM DOD)-EXTRACT(YEAR FROM DOB) YEAR FROM AUTHORS WHERE DOD IS NOT NULL ORDER BY YEAR DESC FETCH FIRST 1 ROWS ONLY;

--10
SELECT AUTHOR_LNAME,DOB FROM AUTHORS WHERE DOB=(SELECT MAX(DOB) FROM AUTHORS) AND DOD IS NULL;

--11
SELECT AUTHOR_ID,COUNT(ISBN) FROM BOOKS GROUP BY AUTHOR_ID;

--12 
SELECT AUTHOR_FNAME, AUTHOR_LNAME FROM AUTHORS WHERE AUTHOR_ID NOT IN (SELECT A.AUTHOR_ID FROM AUTHORS A JOIN BOOKS B ON A.AUTHOR_ID = B.AUTHOR_ID JOIN COPY C ON C.ISBN = B.ISBN JOIN LOANS L ON L.COPY_ID = C.COPY_ID);

--13
SELECT TITLE FROM BOOKS WHERE ISBN NOT IN (SELECT COPY.ISBN FROM BOOKS JOIN COPY ON BOOKS.ISBN = COPY.ISBN JOIN LOANS ON LOANS.COPY_ID = COPY.COPY_ID );

--14 
SELECT SUM(PRICE),EXTRACT(YEAR FROM DOP) YEAR,COUNT(DOP) FROM BOOKS GROUP BY EXTRACT(YEAR FROM DOP);

--15
SELECT SUM(PRICE),GENDER FROM AUTHORS JOIN BOOKS ON AUTHORS.AUTHOR_ID=BOOKS.AUTHOR_ID GROUP BY GENDER;

--16
SELECT ISBN,COUNT(COPY_ID) FROM COPY GROUP BY ISBN ORDER BY COUNT(COPY_ID) DESC FETCH FIRST 1 ROWS ONLY;

--17
SELECT AUTHOR_LNAME,COUNTRY FROM AUTHORS WHERE COUNTRY!='ENGLAND';

--18 
SELECT USER_FNAME,USER_LNAME FROM USERS JOIN LOANS ON USERS.USER_ID = LOANS.USER_ID JOIN BOOKS ON BOOKS.ISBN = LOANS.ISBN WHERE TITLE = 'BLUES FOR A BLACK CAT';
 
--19
SELECT AUTHOR_ID,AVG(PAGES) FROM BOOKS GROUP BY AUTHOR_ID ORDER BY AVG(PAGES) DESC;

--20
SELECT TITLE,PRICE FROM BOOKS ORDER BY PRICE DESC FETCH FIRST 1 ROWS ONLY;


--F BONUS

--1 
SELECT U.USER_ID , SUM(B.PAGES) AS S FROM USERS U JOIN LOANS L ON U.USER_ID = L.USER_ID JOIN COPY C ON C.COPY_ID = L.COPY_ID JOIN BOOKS B ON B.ISBN = C.ISBN GROUP BY U.USER_ID ORDER BY S DESC FETCH FIRST 1 ROWS ONLY;

--2 
SELECT U.USER_ID , COUNT(L.LOAN_ID) AS C FROM USERS U JOIN LOANS L ON U.USER_ID = L.USER_ID GROUP BY U.USER_ID ORDER BY C DESC FETCH FIRST 1 ROWS ONLY;

--3 
SELECT COUNT(LOAN_ID) , GENDER FROM LOANS JOIN USERS ON LOANS.USER_ID = USERS.USER_ID GROUP BY GENDER ;
SELECT AVG(COUNT(LOAN_ID)) FROM LOANS JOIN USERS ON LOANS.USER_ID = USERS.USER_ID GROUP BY GENDER ;

--4
SELECT CONCAT(SUBSTR(USER_FNAME,1,3),SUBSTR(USER_LNAME,1,4)) USERNAME  FROM USERS;

--5
SELECT LOAN_ID ,DOL , (DOL + 14) RETURN_DATE FROM LOANS;

--6
SELECT AUTHOR_LNAME,BOOKS.AUTHOR_ID,PAGES FROM AUTHORS JOIN BOOKS ON AUTHORS.AUTHOR_ID=BOOKS.AUTHOR_ID ORDER BY PAGES DESC FETCH FIRST 1 ROWS ONLY;

--7
SELECT GENRE,COUNT(ISBN) FROM BOOKS GROUP BY GENRE HAVING COUNT(ISBN)=(SELECT MAX(C) FROM (SELECT GENRE,COUNT(ISBN) C FROM BOOKS GROUP BY GENRE));

--8 
SELECT EXTRACT(YEAR FROM DOL) ,COUNT(LOAN_ID) AS C FROM LOANS GROUP BY EXTRACT(YEAR FROM DOL) ORDER BY C DESC FETCH FIRST 1 ROWS ONLY;

--9 
SELECT COUNT(ISBN),COUNTRY FROM AUTHORS JOIN BOOKS ON AUTHORS.AUTHOR_ID=BOOKS.AUTHOR_ID WHERE COUNTRY='GREECE' GROUP BY COUNTRY;

--10
SELECT ISBN,TITLE FROM BOOKS WHERE TITLE LIKE '%MISERY%';

